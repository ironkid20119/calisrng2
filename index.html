<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>calis RNG game</title>
    
    <meta name="theme-color" content="#2d0051">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <style>
        .bootleg-anim { display: inline-block; animation: bootleg-oval 2s linear infinite; }
        @keyframes bootleg-oval { 0% { transform: translate(0, 0); } 25% { transform: translate(20px, 10px); } 50% { transform: translate(0, 20px); } 75% { transform: translate(-20px, 10px); } 100% { transform: translate(0, 0); } }
        .bootleg-anim { display: inline-block; animation: bootleg-oval 2s linear infinite; }
        @keyframes bootleg-oval { 0% { transform: translate(0,0); } 25% { transform: translate(20px, 10px); } 50% { transform: translate(0, 20px); } 75% { transform: translate(-20px, 10px); } 100% { transform: translate(0,0); } }
        body {
            font-family: 'Courier New', monospace;
            background-color: #4a148c;
            color: #ffffff;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #ffffff;
            cursor: pointer;
            user-select: none;
        }
        
        .title-letter {
            cursor: pointer;
            display: inline-block;
            transition: all 0.2s;
            padding: 0 2px;
        }
        
        .title-letter:hover {
            transform: translateY(-3px);
            text-shadow: 0 0 10px #ff69b4;
        }
        
        .title-letter.active-sequence {
            color: #ff69b4;
            font-weight: bold;
            animation: pulse 0.5s;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 20px;
        }
        
        .main-container > div:first-child {
            grid-column: 1;
            grid-row: 1;
        }
        
        .main-container > div:nth-child(2) {
            grid-column: 2;
            grid-row: 1;
        }
        
        .main-container > div:last-child {
            grid-column: 1 / span 2;
            grid-row: 2;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        #terminal {
            background-color: #2d0051;
            border: 2px solid #ff69b4;
            border-radius: 5px;
            padding: 20px;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .output-line {
            margin: 5px 0;
        }
        .command {
            color: #ff69b4;
        }
        .welcome-message {
            color: #ff69b4;
            font-weight: bold;
        }
        .stats {
            background-color: #2d0051;
            border: 2px solid #ff69b4;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .stat-item {
            margin: 8px 0;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            background-color: #808080;
            color: #ffffff;
            border: 2px solid #ff69b4;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }
        button:hover {
            background-color: #a0a0a0;
        }
        button:active {
            transform: scale(0.95);
        }
        button:disabled {
            background-color: #555;
            border-color: #888;
            color: #aaa;
            cursor: not-allowed;
        }
        button.active {
            background-color: #ff69b4;
            color: #000;
        }
        #inventory, #index, #pending-rolls {
            background-color: #2d0051;
            border: 2px solid #ff69b4;
            border-radius: 5px;
            padding: 20px;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
        }
        .inventory-item {
            background-color: #4a148c;
            border: 1px solid #ff69b4;
            padding: 10px;
            margin: 5px 0;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .inventory-item:hover {
            background-color: #5a1a9c;
            transform: translateX(5px);
        }
        .section-header {
            font-size: 18px;
            margin-bottom: 10px;
            color: #ff69b4;
            font-weight: bold;
        }
        .clickable-roll {
            cursor: pointer;
            display: inline-block;
            transition: all 0.2s;
        }
        .clickable-roll:hover {
            transform: scale(1.05);
            text-shadow: 0 0 10px currentColor;
        }
        .index-item {
            background-color: #4a148c;
            border: 1px solid #ff69b4;
            padding: 8px;
            margin: 5px 0;
            border-radius: 3px;
        }
        .index-item.discovered {
            border-color: #00ff00;
        }
        .index-item.locked {
            opacity: 0.5;
            border-color: #666;
        }
        
        .autoroll-settings {
            background-color: #2d0051;
            border: 2px solid #ff69b4;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .autoroll-setting-item {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .autoroll-setting-item label {
            flex-shrink: 0;
        }
        
        .autoroll-setting-item input[type="number"] {
            background-color: #4a148c;
            color: #ffffff;
            border: 1px solid #ff69b4;
            padding: 5px 10px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            width: 150px;
        }
        
        .autoroll-setting-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        /* Scientific Notation Settings */
        .scientific-setting {
            background-color: #2d0051;
            border: 2px solid #00ffff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .scientific-setting-item {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .scientific-setting-item label {
            flex-shrink: 0;
            min-width: 250px;
        }
        
        .scientific-setting-item input[type="number"] {
            background-color: #4a148c;
            color: #ffffff;
            border: 1px solid #00ffff;
            padding: 5px 10px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            width: 200px;
        }
        
        /* UI Customization */
        .ui-customization {
            background-color: #2d0051;
            border: 2px solid #FFA500;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .ui-customization-item {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ui-customization-item label {
            flex-shrink: 0;
            min-width: 150px;
            color: #FFA500;
        }
        
        .ui-customization-item input[type="color"] {
            width: 60px;
            height: 30px;
            cursor: pointer;
            border: 2px solid #FFA500;
            border-radius: 3px;
        }
        
        /* Debug Panel Styles */
        .debug-panel {
            background-color: #2d0051;
            border: 2px solid #ff0000;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }
        
        .debug-panel.unlocked {
            display: block !important;
        }
        
        .debug-warning {
            background-color: #4a0000;
            border: 2px solid #ff0000;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .debug-warning h3 {
            color: #ff0000;
            margin-top: 0;
        }
        
        .debug-password-input {
            background-color: #4a148c;
            color: #ffffff;
            border: 1px solid #ff69b4;
            padding: 10px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            width: 100%;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .debug-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .debug-button {
            background-color: #808080;
            color: #ffffff;
            border: 2px solid #ff0000;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .debug-button:hover {
            background-color: #a0a0a0;
        }
        
        .debug-button.danger {
            background-color: #8b0000;
            color: #ffffff;
            border-color: #ff0000;
        }
        
        .debug-button.danger:hover {
            background-color: #a00000;
        }
        
        .debug-button.confirm {
            background-color: #006400;
            color: #ffffff;
            border-color: #00ff00;
        }
        
        .debug-button.confirm:hover {
            background-color: #008000;
        }
        
        /* Rank colors */
        .rank-1-1000 { color: #ffffff; }
        .rank-1000-10000 { color: #ffff00; }
        .rank-10000-100000 { color: #00ffff; }
        .rank-100000-1000000 { color: #0000cd; }
        .rank-1000000-100000000 { color: #ff0000; }
        .rank-100000000-1000000000 { color: #8b0000; }
        .rank-1000000000-10000000000 { color: #00ff00; }
        .rank-10000000000-100000000000 { color: #ffc0cb; } 
        .rank-100000000000-1000000000000 { color: #a9a9a9; } 
        .rank-1000000000000-100000000000000 { color: #ff69b4; }
        .rank-improbable { color: #008080; }
        .variant-roll {} 
        
        .rank-rainbow {
            background: linear-gradient(90deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbow-shift 3s linear infinite;
            background-size: 200% 100%;
        }

        /* Unobtainable rank style */
        .rank-unobtainable {
    position: relative;
    display: inline-block;
    color: transparent;
    background: linear-gradient(90deg, #000000, #ffffff);
    -webkit-background-clip: text;
    background-clip: text;
    font-weight: bold;
    text-shadow: 
        -1px -1px 0 #808080,
        0 -1px 0 #808080,
        1px -1px 0 #808080,
        -1px 0 0 #808080,
        1px 0 0 #808080,
        -1px 1px 0 #808080,
        0 1px 0 #808080,
        1px 1px 0 #808080;
}
        
        .rank-unobtainable::before {
            content: 'Unobtainable';
            position: absolute;
            left: 0;
            top: 0;
            color: #808080;
            z-index: 1;
            text-shadow: 
                -1px -1px 0 #808080,
                0 -1px 0 #808080,
                1px -1px 0 #808080,
                -1px 0 0 #808080,
                1px 0 0 #808080,
                -1px 1px 0 #808080,
                0 1px 0 #808080,
                1px 1px 0 #808080;
        }
        
        /* --- POLY DODECAHEDRON STYLE --- */
        .poly-dodecahedron-wrapper {
            position: relative;
            display: inline-block;
            z-index: 0;
        }
        
        .poly-dodecahedron-wrapper::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            width: 2em;
            height: 2em;
            background: 
                linear-gradient(135deg, #9b59b6 0%, #3498db 25%, #e74c3c 50%, #f39c12 75%, #9b59b6 100%);
            background-size: 200% 200%;
            -webkit-clip-path: polygon(
                20% 0%, 80% 0%, 100% 20%, 100% 80%, 80% 100%, 20% 100%, 0% 80%, 0% 20%,
                40% 20%, 60% 20%, 70% 40%, 75% 60%, 70% 80%, 40% 80%, 25% 60%, 25% 40%
            );
            clip-path: polygon(
                20% 0%, 80% 0%, 100% 20%, 100% 80%, 80% 100%, 20% 100%, 0% 80%, 0% 20%,
                40% 20%, 60% 20%, 70% 40%, 75% 60%, 70% 80%, 40% 80%, 25% 60%, 25% 40%
            );
            transform: translate(-50%, -50%);
            z-index: -1;
            opacity: 0.75;
            animation: spin-dodecahedron 3s linear infinite;
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.6), inset 0 0 15px rgba(52, 152, 219, 0.4);
        }
        
        @keyframes spin-dodecahedron {
            0% { transform: translate(-50%, -50%) rotateX(0deg) rotateY(0deg) rotateZ(0deg); }
            100% { transform: translate(-50%, -50%) rotateX(360deg) rotateY(360deg) rotateZ(360deg); }
        }
        
        .rank-1e21-1e30 {
            position: relative;
        }
        
        .rank-1e21-1e30::before {
            content: attr(data-text);
            position: absolute;
            left: 0;
            top: 0;
            color: #ffffff;
            font-weight: bold;
            z-index: -1;
            animation: scale-flicker-1e21 2s ease-in-out infinite, color-flicker-1e21 0.8s ease-in-out infinite;
        }
        
        @keyframes scale-flicker-1e21 {
            0%, 100% { transform: scale(1.1); }
            50% { transform: scale(1.9); }
        }
        
        @keyframes color-flicker-1e21 {
            0%, 50% { color: #000000; }
            51%, 100% { color: #ffffff; }
        }
        
        .secret-nonavacious {
            filter: drop-shadow(0 0 5px #00BFFF); 
        }
        
        @keyframes rainbow-shift {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        /* --- CUTSCENE STYLES --- */
        #cutscene-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease-in-out; 
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .cutscene-active #cutscene-overlay {
            opacity: 1;
            pointer-events: all;
        }
        
        .cutscene-flash #cutscene-overlay {
            background-color: #ffffff;
        }

        #star-element {
            position: absolute; 
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            opacity: 0;
            transition: opacity 0.5s ease-in;
            filter: drop-shadow(0 0 15px currentColor);
            background-color: currentColor; 
        }
        
        .star-4 {
            clip-path: polygon(50% 0%, 61% 39%, 100% 50%, 61% 61%, 50% 100%, 39% 61%, 0% 50%, 39% 39%);
        }
        
        .star-6 {
            clip-path: polygon(50% 0%, 65% 20%, 100% 30%, 80% 50%, 100% 70%, 65% 80%, 50% 100%, 35% 80%, 0% 70%, 20% 50%, 0% 30%, 35% 20%);
        }
        
        .star-8 {
            clip-path: polygon(50% 0%, 58% 30%, 100% 30%, 66% 50%, 100% 70%, 58% 70%, 50% 100%, 42% 70%, 0% 70%, 34% 50%, 0% 30%, 42% 30%);
        }
        
        .star-12 {
            clip-path: polygon(50% 0%, 55% 15%, 70% 15%, 75% 0%, 80% 15%, 95% 15%, 100% 30%, 95% 45%, 100% 70%, 95% 85%, 100% 85%, 75% 100%, 70% 85%, 55% 85%, 50% 100%, 45% 85%, 30% 85%, 25% 100%, 20% 85%, 5% 85%, 0% 70%, 5% 45%, 0% 30%, 5% 15%, 20% 15%, 25% 0%, 30% 15%, 45% 15%);
        }

        /* --- END CUTSCENE STYLES --- */

        /* --- SHAPES GUI STYLES --- */
        #shapes-gui {
            background-color: #2d0051;
            border: 2px solid #00FF00;
            padding: 20px;
            border-radius: 5px;
            display: none;
        }

        .shapes-field {
            background-color: #1a0033;
            border: 1px dashed #00FF00;
            min-height: 200px;
            max-height: 300px;
            overflow: hidden; 
            position: relative;
            margin-bottom: 15px;
        }

        .clickable-shape {
            position: absolute;
            width: 30px;
            height: 30px;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px;
            font-weight: bold;
            color: #000;
            text-shadow: 0 0 3px currentColor;
            border-radius: 2px;
            animation: float 5s ease-in-out infinite alternate; 
        }

        @keyframes float {
            0% { transform: translateY(0px) rotate(0deg); }
            100% { transform: translateY(-5px) rotate(5deg); }
        }

        .shape-Triangle { clip-path: polygon(50% 0%, 0% 100%, 100% 100%); }
        .shape-Square { clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%); }
        .shape-Pentagon { clip-path: polygon(50% 0%, 100% 38%, 81% 100%, 19% 100%, 0% 38%); }
        .shape-Hexagon { clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); }
        .shape-7-Sided-Polygon { clip-path: polygon(50% 0%, 90% 20%, 100% 60%, 75% 100%, 25% 100%, 0% 60%, 10% 20%); }
        .shape-Octagon { clip-path: polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%); }
        .shape-Circle { border-radius: 50%; }

        .shape-spawn-output {
            background-color: #1a0033;
            border: 1px solid #00FF00;
            padding: 10px;
            min-height: 50px;
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 15px;
        }
        
        .shape-spawn-line {
            margin: 5px 0;
            color: #00FF00;
        }
        
        .shapes-upgrades {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        /* --- END NEW STYLES --- */

        /* --- CLICKER GUI STYLES --- */
        #clicker-gui {
            background-color: #2d0051;
            border: 2px solid #FFD700;
            padding: 20px;
            border-radius: 5px;
            display: none;
        }

        #clover-clicker:active {
            transform: scale(0.9);
        }
        /* --- END NEW STYLES --- */
        
        /* --- SATANIC SECRET STYLE --- */
        .satanic-wrapper {
            position: relative;
            display: inline-block; 
            z-index: 0;
        }
        
        .satanic-wrapper::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            width: 2.5em;
            height: 2.5em;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><polygon points="50,5 61,40 98,40 68,62 79,96 50,75 21,96 32,62 2,40 39,40" style="fill:red;"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            transform: translate(-50%, -50%); 
            z-index: -1; 
            opacity: 0.75;
            animation: rotate-pentagram 9.009s linear infinite;
        }
        
        @keyframes rotate-pentagram {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        /* --- END NEW STYLE --- */

        /* --- CORRUPTED SECRET STYLE --- */
        .secret-corrupted {
            display: inline-block;
            animation: corrupted-shake 12.5ms linear infinite;
            filter: invert(100%);
        }
        
        @keyframes corrupted-shake {
            0%    { transform: rotate(0deg); }
            16.67% { transform: rotate(22.5deg); }
            33.33% { transform: rotate(45deg); }
            50%    { transform: rotate(0deg); }
            66.67% { transform: rotate(-22.5deg); }
            83.33% { transform: rotate(-45deg); }
            100%   { transform: rotate(0deg); }
        }
        /* --- END NEW STYLE --- */

        /* --- Complex rank animation --- */
        .rank-complex {
            background: linear-gradient(90deg, #ff0000, #00ff00, #0000ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: complex-shift 2s linear infinite;
            background-size: 300% 100%;
            font-weight: bold;
        }
        
        @keyframes complex-shift {
            0% { background-position: 0% 50%; }
            100% { background-position: 300% 50%; }
        }
        /* --- END Complex rank animation --- */

        /* --- Pending rolls styles --- */
        .pending-roll-item {
            background-color: #3a0d6e;
            border: 1px solid #ffff00;
            padding: 10px;
            margin: 5px 0;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pending-roll-buttons {
            display: flex;
            gap: 5px;
        }
        
        .pending-accept-btn {
            background-color: #00ff00;
            color: #000;
            border: 1px solid #00ff00;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .pending-decline-btn {
            background-color: #ff0000;
            color: #000;
            border: 1px solid #ff0000;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        /* --- END Pending rolls styles --- */

        /* --- Hardcore mode styles --- */
        .hardcore-rank {
            border-left: 3px solid #ff0000;
            padding-left: 5px;
            font-style: italic;
        }
        
        .hardcore-mode-active {
            background-color: #2d0051;
            border: 2px solid #ff0000;
        }
        
        .hardcore-mode-active .stat-item {
            color: #ff6666;
        }

        /* --- Illegitimate roll style --- */
        .illegitimate-roll {
            opacity: 0.7;
            text-decoration: line-through;
            color: #ff5555 !important;
        }

        /* --- NEW: Variant Secrets Styles --- */
        .variant-secrets-section {
            margin-top: 20px;
            border-top: 1px solid #ff69b4;
            padding-top: 15px;
        }
        
        .variant-secret-item {
            background-color: #4a148c;
            border: 1px solid #00ffff;
            padding: 8px;
            margin: 5px 0;
            border-radius: 3px;
        }
        
        .variant-secret-item.discovered {
            border-color: #00ff00;
        }
        
        .variant-secret-item.locked {
            opacity: 0.5;
            border-color: #666;
        }
        
        .variant-secret-note {
            font-size: 0.8em;
            color: #00ffff !important;
            font-style: italic;
        }
        
        .variant-secret-badge {
            background-color: #0044cc;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7em;
            margin-left: 5px;
            vertical-align: middle;
        }

        /* --- 1e21-1e30 Rank Style --- */
        .rank-1e21-1e30 {
            position: relative;
            color: #000000;
            font-weight: bold;
            animation: triple-invert 0.8s ease-in-out infinite alternate;
        }
        
        @keyframes triple-invert {
            0% {
                color: #ffffff;
                text-shadow: 0 0 10px #ffffff;
            }
            50% {
                color: #000000;
                text-shadow: 0 0 10px #000000;
            }
            100% {
                color: #ffffff;
                text-shadow: 0 0 10px #ffffff;
            }
        }
        /* --- END 1e21-1e30 Rank Style --- */

        /* --- Variant text size styles --- */
        .variant-GIANT {
            font-size: 5em !important;
            display: inline-block;
            line-height: 1;
            vertical-align: middle;
        }
        
        .variant-Mega {
            font-size: 1.5em !important;
            display: inline-block;
            line-height: 1;
            vertical-align: middle;
        }
        
        .variant-Small {
            font-size: 0.75em !important;
            display: inline-block;
            line-height: 1;
            vertical-align: middle;
        }

        /* --- DESTROY SYSTEM STYLES --- */
        .destroy-system {
            background-color: #2d0051;
            border: 2px solid #8B0000;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .destroy-warning {
            background-color: #4a0000;
            border: 2px solid #ff0000;
            padding: 10px;
            border-radius: 3px;
            margin-bottom: 10px;
        }
        
        .destroy-dimension-list {
            max-height: 150px;
            overflow-y: auto;
            background-color: #1a0033;
            border: 1px solid #8B0000;
            padding: 10px;
            border-radius: 3px;
            margin-bottom: 10px;
        }
        
        .dimension-item {
            padding: 5px;
            margin: 3px 0;
            border-left: 3px solid #8B0000;
            background-color: #2d0051;
        }
        
        .dimension-item.current {
            border-left-color: #FF0000;
            background-color: #3a0d6e;
            font-weight: bold;
        }
        
        /* Dimension Selector Styles */
        .dimension-selector-container {
            margin: 10px 0;
        }
        
        .dimension-select {
            background-color: #4a148c;
            color: #ffffff;
            border: 1px solid #8B0000;
            padding: 8px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            width: 200px;
            font-size: 14px;
        }
        
        .dimension-select option {
            background-color: #2d0051;
            color: #ffffff;
        }
        
        /* --- Feimienation Secret Style --- */
        .feimienation-wrapper {
            display: inline-block;
            animation: feimienation-rotate 5ms linear infinite, serotonin-flicker 15ms linear infinite;
            filter: invert(100%) hue-rotate(90deg);
        }
        
        @keyframes feimienation-rotate {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-22.5deg) scale(1.1); }
            50% { transform: rotate(0deg) scale(1); }
            75% { transform: rotate(45deg) scale(0.9); }
            100% { transform: rotate(25deg) scale(1); }
        }
        
        @keyframes serotonin-flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        /* --- END NEW STYLES --- */

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }
            
            .main-container > div:first-child,
            .main-container > div:nth-child(2),
            .main-container > div:last-child {
                grid-column: 1;
                grid-row: auto;
            }
            
            .main-container > div:last-child {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="cutscene-inactive">
    <!-- Modified title with clickable letters -->
    <h1 id="game-title">
        <span class="title-letter" data-letter="c">c</span>
        <span class="title-letter" data-letter="a">a</span>
        <span class="title-letter" data-letter="l">l</span>
        <span class="title-letter" data-letter="i">i</span>
        <span class="title-letter" data-letter="s">s</span>
        <span>&nbsp;</span>
        <span class="title-letter" data-letter="R">R</span>
        <span class="title-letter" data-letter="N">N</span>
        <span class="title-letter" data-letter="G">G</span>
        <span>&nbsp;</span>
        <span class="title-letter" data-letter="g">g</span>
        <span class="title-letter" data-letter="a">a</span>
        <span class="title-letter" data-letter="m">m</span>
        <span class="title-letter" data-letter="e">e</span>
    </h1>
    
    <div class="stats">
        <div class="stat-item">Currency: <span id="currency">0.00</span></div>
        <div class="stat-item">Geometrix: <span id="geometrix">0.00</span></div>
        <div class="stat-item">Total Upgrades: <span id="upgrades">0</span></div>
        <div class="stat-item">Luck: +<span id="luck">0.000</span></div>
        <div class="stat-item">Luck Multiplier: <span id="luckMulti">1.00</span>x</div>
        <div class="stat-item">Secret Luck: <span id="secretLuck">1.00</span>x</div>
        <div class="stat-item">Variant Chance: <span id="variantChance">1.00</span>x</div>
        <div class="stat-item">Next Upgrade Cost: <span id="upgradeCost">50.00</span></div>
        <div class="stat-item">Bulk Roll (Lvl <span id="bulkRollLevel">0</span>): <span id="bulkRollAmount">1</span> roll/click</div>
        <div class="stat-item">Next Bulk Roll Cost: <span id="bulkRollCost">500,000.00</span></div>
        <div class="stat-item">Inventory: <span id="inventoryCount">0</span>/<span id="inventoryMax">10</span></div>
        <div class="stat-item">Pending Rolls: <span id="pendingCount">0</span>/<span id="pendingMax">30</span></div>
        <div class="stat-item">Rarest Roll: <span id="rarest">None yet</span></div>
        <div class="stat-item">Ranks Discovered: <span id="ranksDiscovered">0</span>/<span id="totalRanks">60</span></div>
        <div class="stat-item">Secrets Enabled: <span id="secretsEnabled">Yes</span></div>
        <div class="stat-item">Hardcore Mode: <span id="hardcoreStatus">OFF</span></div>
        <div class="stat-item">Scientific Notation: <span id="sciNotationStat">ON (‚â•1e18)</span></div>
        <div class="stat-item">Variant Secrets: <span id="variantSecretsDiscovered">0</span>/<span id="totalVariantSecrets">10</span></div>
        <!-- NEW: Destroy System Stats -->
        <div class="stat-item">Dimension: <span id="dimension">1</span></div>
        <div class="stat-item">Destroys: <span id="destroyCount">0</span></div>
        <div class="stat-item">Destroy Multi: <span id="destroyMulti">1.00</span>x Luck, <span id="currencyMulti">1.00</span>x Currency</div>
        <div class="stat-item">Next Destroy Cost: <span id="destroyCost">100,000,000.00</span></div>
    </div>

    <div class="scientific-setting">
        <div class="section-header">Scientific Notation Settings</div>
        <div class="scientific-setting-item">
            <label>Scientific notation threshold (‚â•):</label>
            <input type="number" id="sciNotationThreshold" value="1000000000000000000" min="1" step="0.000001">
        </div>
        <div class="scientific-setting-item">
            <button onclick="toggleScientificNotation()">Toggle Scientific Notation: <span id="sciNotationStatus">ON</span></button>
        </div>
        <div class="scientific-setting-item" style="color: #00ffff; font-size: 12px;">
            Note: Numbers ‚â• threshold will display in scientific notation (e.g., 1.23e18)
        </div>
    </div>

    <!-- NEW: Destroy System Panel -->
    <div class="destroy-system">
        <div class="section-header" style="color: #8B0000;">Destroy System</div>
        <div class="destroy-warning">
            <strong>‚ö†Ô∏è WARNING:</strong> Destroying resets ALL progress (except ranks) for permanent multipliers! Each Destroy increases dimension.
        </div>
        
        <div class="stat-item" style="margin: 10px 0;">
            Current Dimension Stats: 
            <span id="currentDimensionStats">Dimension 1: 1.00x Luck, 1.00x Currency</span>
        </div>
        
        <div class="controls" style="grid-template-columns: 1fr; margin-bottom: 10px;">
            <button id="destroyBtn" onclick="initiateDestroy()" style="background-color: #8B0000; border-color: #FF0000;">
                DESTROY (Cost: <span id="destroyCostBtn">100,000,000.00</span>)
            </button>
            
            <!-- NEW: Dimension Selector -->
            <div class="dimension-selector-container">
                <select id="dimensionSelect" class="dimension-select" onchange="switchToSelectedDimension()">
                    <option value="1">Dimension 1</option>
                </select>
                <button onclick="switchToSelectedDimension()" style="background-color: #4a148c; border-color: #800080; margin-left: 10px;">
                    Switch Dimension
                </button>
            </div>
        </div>
        
        <div class="section-header" style="color: #800080; margin-top: 15px;">Dimension List</div>
        <div class="destroy-dimension-list" id="dimensionList">
            <div class="dimension-item current">Dimension 1: 1.00x Luck, 1.00x Currency</div>
        </div>
        
        <div style="color: #FFA500; font-size: 12px; margin-top: 10px;">
            Each Destroy: +1.00x Luck Multi, +0.50x Currency Gain<br>
            Progress is preserved per dimension
        </div>
    </div>

    <div class="ui-customization">
        <div class="section-header" style="color: #FFA500;">UI Customization</div>
        <div class="ui-customization-item">
            <label>Background Color:</label>
            <input type="color" id="ui-bg-color" value="#4a148c">
        </div>
        <div class="ui-customization-item">
            <label>Button Background:</label>
            <input type="color" id="ui-button-bg" value="#808080">
        </div>
        <div class="ui-customization-item">
            <label>Button Outline:</label>
            <input type="color" id="ui-button-outline" value="#ff69b4">
        </div>
        <div class="ui-customization-item">
            <label>HC Mode UI Color:</label>
            <input type="color" id="ui-hc-color" value="#ff0000">
        </div>
        <div class="ui-customization-item">
            <label>Text Color:</label>
            <input type="color" id="ui-text-color" value="#ffffff">
        </div>
        <div class="ui-customization-item">
            <button onclick="applyUICustomization()" style="background-color: #FFA500; border-color: #FFA500; color: #000;">Apply UI Changes</button>
            <button onclick="resetUICustomization()" style="background-color: #808080; border-color: #ff69b4; color: #fff;">Reset to Default</button>
        </div>
    </div>

    <!-- Debug Panel - Will be unlocked by clicking "c r i n g e" sequence -->
    <div class="debug-panel" id="debug-panel">
        <div class="debug-warning">
            <h3>‚ö†Ô∏è DEBUG PANEL ‚ö†Ô∏è</h3>
            <p>Debug panel unlocked! Use with caution.</p>
        </div>
        
        <div id="debug-commands">
            <div class="section-header" style="color: #ff0000;">Debug Commands</div>
            <div class="debug-buttons">
                <button onclick="resetEventsDebug()" class="debug-button">Event Resetter (fixes bugged events)</button>
                <button onclick="resetSaveDebug()" class="debug-button danger">Save Resetter (5 confirmations)</button>
                <button onclick="toggleForceRollUI()" class="debug-button">Force Roll (Custom)</button>
                <button onclick="nukeShopData()" class="debug-button danger">Nuke Shop Data</button>
                <button onclick="fixSaveFile()" class="debug-button">Fix Save File</button>
                <button onclick="inspectSaveFile()" class="debug-button">Inspect Save File</button>
                <button onclick="toggleRuin()" class="debug-button danger">Toggle Ruin Mode</button>
                <button onclick="closeDebugPanel()" class="debug-button">Close Debug Panel</button>
            </div>
            <div id="force-roll-ui" style="display: none; margin-top: 15px; padding: 15px; background-color: #3a0d6e; border: 1px solid #ff0000; border-radius: 5px;">
                <div style="color: #FFD700; font-weight: bold; margin-bottom: 10px;">Custom Force Roll</div>
                <div style="margin-bottom: 10px;">
                    <label style="color: #ffffff;">Luck:</label>
                    <input type="number" id="forceRollLuck" value="0" style="width: 100%; padding: 5px; background-color: #4a148c; color: #ffffff; border: 1px solid #FFD700;">
                </div>
                <div style="margin-bottom: 10px;">
                    <label style="color: #ffffff;">Variant Luck:</label>
                    <input type="number" id="forceRollVariantLuck" value="0" style="width: 100%; padding: 5px; background-color: #4a148c; color: #ffffff; border: 1px solid #FFD700;">
                </div>
                <div style="margin-bottom: 10px;">
                    <label style="color: #ffffff;">Secret Luck:</label>
                    <input type="number" id="forceRollSecretLuck" value="0" style="width: 100%; padding: 5px; background-color: #4a148c; color: #ffffff; border: 1px solid #FFD700;">
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="executeCustomForceRoll()" class="debug-button" style="flex: 1;">Roll</button>
                    <button onclick="toggleForceRollUI()" class="debug-button" style="flex: 1; background-color: #555;">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div class="autoroll-settings" style="padding-bottom: 5px;">
        <div class="section-header">Auto Accept Settings</div>
        <div class="autoroll-setting-item">
            <label>Accept on value ‚â•:</label>
            <input type="number" id="autoAcceptThreshold" value="0" step="0.000001" placeholder="Enter minimum value">
        </div>
        <div class="autoroll-setting-item">
            <label>Accept on base rank ‚â•:</label>
            <input type="number" id="autoAcceptTrueRNG" value="0" step="0.000001" placeholder="Enter minimum base value">
        </div>
        <div class="autoroll-setting-item">
            <label>Accept on secret rarity ‚â•:</label>
            <input type="number" id="autoAcceptSecretThreshold" value="0" step="0.000001" placeholder="Enter minimum rarity">
        </div>
        <div class="autoroll-setting-item">
            <input type="checkbox" id="autoAcceptNewRank">
            <label for="autoAcceptNewRank">Accept on new rank discovery</label>
        </div>
        
        <div class="section-header" style="margin-top: 15px;">Auto Stop Settings</div>
        <div class="autoroll-setting-item">
            <label>Stop on value ‚â•:</label>
            <input type="number" id="autoStopThreshold" value="0" step="0.000001" placeholder="Enter minimum value">
        </div>
        <div class="autoroll-setting-item">
            <label>Stop on base rank ‚â•:</label>
            <input type="number" id="autoStopTrueRNG" value="0" step="0.000001" placeholder="Enter minimum base value">
        </div>
        <div class="autoroll-setting-item">
            <label>Stop on secret rarity ‚â•:</label>
            <input type="number" id="autoStopSecretThreshold" value="0" step="0.000001" placeholder="Enter minimum rarity">
        </div>
        <div class="autoroll-setting-item">
            <input type="checkbox" id="autoStopNewRank">
            <label for="autoStopNewRank">Stop on new rank discovery</label>
        </div>
        
        <div class="section-header" style="margin-top: 15px;">Import / Export Save</div>
        <textarea id="saveDataTextarea" style="width: 95%; min-height: 80px; background-color: #4a148c; color: #ffffff; border: 1px solid #ff69b4; font-family: 'Courier New', monospace; margin-bottom: 15px; padding: 5px; resize: vertical;" placeholder="Paste save data here and click 'Import Save'"></textarea>
        <div class="controls" style="grid-template-columns: 1fr 1fr; margin-bottom: 10px;">
            <button onclick="exportSave()">Export Save</button>
            <button onclick="importSave()">Import Save</button>
        </div>
        <div id="hardcore-warning" style="color: #ff0000; display: none; margin-top: 10px; padding: 10px; background-color: #3a0d6e; border: 1px solid #ff0000;">
            <strong>‚ö†Ô∏è Hardcore Mode Active:</strong> Bulk=1, Luck=1, Variant=1, Secret=1, Events disabled
        </div>
    </div>

    <div class="controls">
        <button onclick="roll()">Roll (r)</button>
        <button id="autoRollBtn" onclick="toggleAutoRoll()">Auto Roll</button>
        <button onclick="buyUpgrade()">Buy Upgrade</button>
        <button id="buyBulkRollBtn" onclick="buyBulkRoll()">Buy Bulk Roll</button>
        <button onclick="showRarest()">Show Rarest</button>
        <button onclick="clearTerminal()">Clear Terminal</button>
        <button onclick="saveGame()">Save Game</button>
        <button id="cutsceneToggleBtn" onclick="toggleCutscenes()">Cutscenes: ON</button>
        <button id="secretToggleBtn" onclick="toggleSecrets()">Secrets: ON</button>
        <button id="hardcoreToggleBtn" onclick="toggleHardcoreMode()">Hardcore Mode: OFF</button>
        <button onclick="openBoosterShop()">Shop</button>
    </div>
    
    <div id="shop-panel" style="display: none; background-color: #2d0051; border: 2px solid #FFD700; padding: 20px; border-radius: 5px; margin-top: 10px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <div class="section-header" style="color: #FFD700; margin: 0;">Booster Shop</div>
            <button onclick="closeBoosterShop()" style="background-color: #8b0000; border-color: #ff0000; padding: 5px 10px; cursor: pointer;">Close</button>
        </div>
        <div id="shop-content" style="min-height: 100px; background-color: #4a148c; border: 1px solid #FFD700; padding: 10px; border-radius: 3px; text-align: center;"></div>
        <div style="margin-top: 15px; color: #FFD700; font-size: 12px; text-align: center;">Click shapes to buy ‚Ä¢ Your Boosters:</div>
        <div id="booster-list" style="min-height: 50px; max-height: 150px; overflow-y: auto; background-color: #4a148c; border: 1px solid #FFD700; padding: 10px; border-radius: 3px; margin-top: 10px;">
            <div id="boosterContent">No boosters owned</div>
        </div>
    </div>
    
    <div class="main-container">
        <div>
            <div id="terminal"></div>
        </div>
        <div>
            <div id="inventory">
                <div class="section-header">Inventory</div>
                <div class="controls" style="grid-template-columns: 1fr 1fr; margin-bottom: 10px;">
                    <button onclick="sortInventory('baseRNGAsc')">Base RNG ‚Üë</button>
                    <button onclick="sortInventory('baseRNGDesc')">Base RNG ‚Üì</button>
                </div>
                <div id="inventoryContent">Empty</div>
            </div>
        </div>
        <div>
            <div class="right-column">
                <div id="index">
                    <div class="section-header">Index (Ranks Discovered)</div>
                    <div id="indexContent">Roll to discover ranks!</div>
                </div>
                
                <div id="pending-rolls">
                    <div class="section-header">Pending Rolls</div>
                    <div id="pendingContent">Empty</div>
                </div>
                
                <div class="controls" id="shapes-unlock-controls">
                    <button id="unlockShapesBtn" onclick="unlockShapes()">Unlock Shapes GUI (5,000,000.00 Currency)</button>
                </div>
                
                <div id="shapes-gui">
                    <div class="section-header" style="color: #00FF00;">Shapes GUI</div>
                    
                    <div id="shapes-field" class="shapes-field"></div>

                    <div class="stat-item">Current Shape Luck: +<span id="shapeLuckBonus">0.0</span>x</div>
                    <div class="stat-item">Shapes/Spawn: <span id="bulkShapeAmount">1</span> (Lvl <span id="bulkShapeLevel">0</span>)</div>
                    <div class="stat-item">Spawn Cooldown: <span id="shapeCooldown">2.0000</span>s</div>
                    
                    <div class="shape-spawn-output" id="shape-spawn-output" style="height: 50px;">Waiting for first spawn...</div>

                    <div class="shapes-upgrades">
                        <button id="buyShapeLuckBtn" onclick="buyShapeLuckUpgrade()">Shape Luck (+0.1x) - Cost: <span id="shapeLuckCost">5.00</span> GMX</button>
                        <button id="buyLuckMultiBtn" onclick="buyLuckMultiUpgrade()">Luck Multiplier (x2.00) - Cost: <span id="luckMultiCost">100.00</span> GMX</button>
                        <button id="buyBulkShapeBtn" onclick="buyBulkShapeUpgrade()">Bulk/Cooldown Lvl <span id="bulkShapeLevelBtn">1</span> - Cost: <span id="bulkShapeCost">50.00</span> GMX</button>
                        <button id="buyClickerUnlockBtn" onclick="unlockClicker()">Unlock Clicker - Cost: 1,000,000.00 GMX</button>
                    </div>
                </div>
                
                <div id="clicker-gui">
                    <div class="section-header" style="color: #FFD700;">Clicker</div>
                    
                    <div class="stats" style="background-color: #2d0051; border-color: #FFD700; padding: 10px; margin-bottom: 10px;">
                        <div class="stat-item">Fortunium: <span id="fortunium">0.00</span></div>
                        <div class="stat-item">Fortunium Luck: +<span id="fortuniumLuck">0.00</span>x</div>
                    </div>

                    <div id="clover-field" style="text-align: center; margin-bottom: 15px;">
                         <span id="clover-clicker" style="font-size: 80px; cursor: pointer; display: inline-block; transition: transform 0.1s; user-select: none;">üçÄ</span>
                    </div>

                    <div class="clicker-upgrades" style="display: flex; flex-wrap: wrap; gap: 10px;">
                        <button id="buyGmxMultiBtn" onclick="buyFortuniumUpgrade('gmx')">GMX Multi (+0.5x) - Cost: <span id="gmxMultiCost">75.00</span> FOR</button>
                        <button id="buyFortuniumLuckBtn" onclick="buyFortuniumUpgrade('fortuniumLuck')">Fortunium Luck (+0.5x) - Cost: <span id="fortuniumLuckCost">125.00</span> FOR</button>
                        <button id="buyClickerLuckBtn" onclick="buyFortuniumUpgrade('luck')">Luck Multi (+0.5x) - Cost: <span id="clickerLuckCost">1000.00</span> FOR</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="cutscene-overlay">
        <div id="star-element" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);"></div>
    </div>

    <script>
        // --- GLOBAL RUIN VARIABLE ---
        window.calisrng2 = {
            ruin: false,
            ruinInterval: null,
            ruinOriginalColors: new Map(),
            ruinOriginalTexts: new Map()
        };

        function startRuin() {
            if (calisrng2.ruinInterval) clearInterval(calisrng2.ruinInterval);
            
            document.querySelectorAll('*').forEach(el => {
                if (el.style) {
                    calisrng2.ruinOriginalColors.set(el, {
                        color: el.style.color,
                        backgroundColor: el.style.backgroundColor
                    });
                }
                if (el.textContent && el.children.length === 0) {
                    calisrng2.ruinOriginalTexts.set(el, el.textContent);
                }
            });
            
            calisrng2.ruinInterval = setInterval(() => {
                document.querySelectorAll('*').forEach(el => {
                    if (el.style) {
                        el.style.color = '#' + Math.floor(Math.random() * 16777215).toString(16);
                        el.style.backgroundColor = '#' + Math.floor(Math.random() * 16777215).toString(16);
                    }
                });
                
                document.querySelectorAll('*').forEach(el => {
                    if (el.children.length === 0 && el.textContent) {
                        el.textContent = "Lol";
                        if (el.innerHTML) el.innerHTML = "Lol";
                    }
                });
                
                document.querySelectorAll('*').forEach(el => {
                    el.style.transform = `translate(${Math.random() * 20 - 10}px, ${Math.random() * 20 - 10}px)`;
                });
                
                document.querySelectorAll('*').forEach(el => {
                    el.style.fontSize = `${Math.random() * 3 + 0.5}em`;
                });
            }, 50);
            
            addToTerminal("‚ö†Ô∏è RUIN MODE ACTIVATED! Everything is broken!", true, 'rank-1000000-100000000');
        }

        function stopRuin() {
            if (calisrng2.ruinInterval) {
                clearInterval(calisrng2.ruinInterval);
                calisrng2.ruinInterval = null;
                
                calisrng2.ruinOriginalColors.forEach((colors, el) => {
                    if (el.style) {
                        el.style.color = colors.color;
                        el.style.backgroundColor = colors.backgroundColor;
                    }
                });
                
                calisrng2.ruinOriginalTexts.forEach((text, el) => {
                    if (el.textContent) {
                        el.textContent = text;
                        if (el.innerHTML) el.innerHTML = text;
                    }
                });
                
                document.querySelectorAll('*').forEach(el => {
                    el.style.transform = '';
                    el.style.fontSize = '';
                });
                
                addToTerminal("Ruin mode deactivated. Game restored.", true);
            }
        }

        function toggleRuin() {
            calisrng2.ruin = !calisrng2.ruin;
        }

        Object.defineProperty(window.calisrng2, 'ruin', {
            set: function(value) {
                this._ruin = value;
                if (value) {
                    startRuin();
                } else {
                    stopRuin();
                }
            },
            get: function() {
                return this._ruin;
            }
        });

        // --- DEBUG PANEL UNLOCK SEQUENCE ---
        const DEBUG_SEQUENCE = ['c', 'r', 'i', 'n', 'g', 'e'];
        let currentSequence = [];
        let debugUnlocked = false;
        
        function initTitleClickSequence() {
            const titleLetters = document.querySelectorAll('.title-letter');
            titleLetters.forEach(letter => {
                letter.addEventListener('click', function() {
                    if (debugUnlocked) return;
                    
                    const clickedLetter = this.getAttribute('data-letter').toLowerCase();
                    
                    // Reset sequence if wrong letter
                    if (currentSequence.length > 0 && 
                        clickedLetter !== DEBUG_SEQUENCE[currentSequence.length]) {
                        resetSequence();
                    }
                    
                    // Check if this is the next letter in sequence
                    if (clickedLetter === DEBUG_SEQUENCE[currentSequence.length]) {
                        currentSequence.push(clickedLetter);
                        this.classList.add('active-sequence');
                        
                        // Check if sequence is complete
                        if (currentSequence.length === DEBUG_SEQUENCE.length) {
                            unlockDebugPanel();
                        }
                        
                        // Remove active class after animation
                        setTimeout(() => {
                            this.classList.remove('active-sequence');
                        }, 500);
                    }
                });
            });
        }
        
        function resetSequence() {
            currentSequence = [];
            const titleLetters = document.querySelectorAll('.title-letter');
            titleLetters.forEach(letter => {
                letter.classList.remove('active-sequence');
            });
        }
        
        function unlockDebugPanel() {
            debugUnlocked = true;
            const debugPanel = document.getElementById('debug-panel');
            debugPanel.classList.add('unlocked');
            debugPanel.style.display = 'block';
            
            // Truncated password
            const DEBUG_PASSWORD = "c";
            
            // Auto-fill and confirm
            document.getElementById('debug-password-input').value = DEBUG_PASSWORD;
            checkDebugPassword();
            
            addToTerminal('‚ö†Ô∏è DEBUG PANEL UNLOCKED! Clicked sequence: c r i n g e', true, 'rank-1000000-100000000');
            
            // Save debug unlock state
            localStorage.setItem('calisRNG_debugUnlocked', 'true');
        }
        
        function checkDebugPassword() {
            const input = document.getElementById('debug-password-input').value;
            const DEBUG_PASSWORD = "c"; // Truncated password
            
            if (input === DEBUG_PASSWORD || debugUnlocked) {
                document.getElementById('debug-commands').style.display = 'block';
                if (!debugUnlocked) {
                    addToTerminal('Debug panel unlocked! Use with caution!', true, 'rank-1000000-100000000');
                }
            } else if (input.toLowerCase() === 'no') {
                closeDebugPanel();
            } else {
                alert('Incorrect password! Type "no" to close the debug panel.');
            }
        }
        
        function closeDebugPanel() {
            if (!debugUnlocked) {
                document.getElementById('debug-panel').style.display = 'none';
                document.getElementById('debug-password-input').value = '';
                document.getElementById('debug-commands').style.display = 'none';
                addToTerminal('Debug panel closed.', true);
            }
        }

        // --- CONSTANTS ---
        const POWER_EXPONENT = -2;
        const AUTO_ROLL_DELAY_MS = 17.5;
        const UPGRADE_COST_MULTIPLIER = 1.15;
        const LUCK_PER_UPGRADE = 2.5;
        const INVENTORY_PER_UPGRADE = 10;
        const VARIANT_CHANCE_PER_UPGRADE = 0.05;
        const MAX_VARIANT_CHANCE_MULTIPLIER = 12.5;
        const SECRET_LUCK_PER_UPGRADE = 0.25;
        const MAX_SECRET_LUCK = 7.5;
        const BULK_ROLL_COST_MULTIPLIER = 2.5;
        const MAX_BULK_ROLL_LEVEL = 9;
        const MAX_VARIANTS_PER_ROLL = 5; 
        
        const CUTSCENE_DURATION_MS = 7000;
        const STAR_FADE_IN_MS = 2000;
        const SPIN_ACCEL_MS = 5000;
        const SIZE_UPDATE_INTERVAL_MS = 10; 
        const SIZE_MULTIPLIER_PER_UPDATE = 1.02;
        const WHITE_FLASH_DURATION_MS = 1000; 

        const EVENT_CHECK_INTERVAL_MS = 1750; 

        const EVENTS = [
            { 
                name: "Error", 
                chance: 1/10.1, 
                duration: 15000,
                description: "makes nil, Title Label Missing and unknown's rarity be easier by x4 (this event sucks bro whyd i add it)",
                targets: ["nil", "Title Label Missing", "?!? unknown ?!?"],
                multiplier: 4 
            },
            { 
                name: "Lol", 
                chance: 1/12.5, 
                duration: 20000,
                description: "makes every meme related secret easier by 6.94x and boosts future event chances",
                targets: ["r", "fish", "cheese", "c", "cheese : cheddar", "LEGACY In im table ?!?!?", "QHAR ?!?", "7 GRAND DAD"],
                multiplier: 6.94,
                eventChanceBoost: 69 
            },
            { 
                name: "UNDEFINED", 
                chance: 1/175, 
                duration: 30000,
                description: "makes ranks 'unknown,' 'title label missing' and 'absolute zero' be x5 times easier",
                targets: ["?!? unknown ?!?", "Title Label Missing", ":[{(absolute zero)}]:"],
                multiplier: 5
            },
            { 
                name: "Modified", 
                chance: 1/300, 
                duration: 7500,
                description: "makes every variant x5 times easier",
                targets: [],
                multiplier: 5
            },
            { 
                name: "Self Insert", 
                chance: 1/77, 
                duration: 77777,
                description: "makes cali^2 easier by x777,777.777",
                targets: ["cali^2"],
                multiplier: 777777.777
            },
            { 
                name: "Hellish", 
                chance: 1/66.66, 
                duration: 66666,
                description: "makes ‚õßSatanic‚õß, Seize and Insanity x6.66 easier",
                targets: ["‚õßSatanic‚õß", "Seize", "Insanity"],
                multiplier: 6.66 
            },
            {
                name: "ULTRA",
                chance: 1/1000,
                duration: 3333,
                description: "EVERY SECRET IS x100 EASIER FOR A FEW SECONDS.",
                targets: ["ALL_SECRETS"],
                multiplier: 100
            },
            {
            name: "Exclusivity",
            chance: 1/72.5,
            duration: 30000,
            description: "EVERY dev exclusive is rollable for 30s",
            targets: ["ALL_SECRETS"],
            multiplier: 1
            },
            {
    name: "Impossibility",
    chance: 1/333.33,
    duration: 60000,
    description: "SUPER HARD secrets are super easier.",
    targets: ["cali^2", "Guardian", "one", "Obscure", "SUPERNOVA", "Omnipotence", "LEGACY In im table ?!?!?", "chezburger", "( N A M E L E S S )" ],
    multiplier: 10000
},
            { 
                name: "Hidden", 
                chance: 1/750, 
                duration: 15000,
                description: "makes EVERY secret X7.77 easier",
                targets: ["ALL_SECRETS"],
                multiplier: 7.77
            }
        ];

        const VARIANTS = [
            { name: "Void", chance: 1/750000000, multiplier: 1, color: "linear-gradient(90deg, #000000, #4b0082)" },
            { name: "nil", chance: 1/1000000000, multiplier: 1, color: "linear-gradient(90deg, #000000, #333333, #000000)" },
            { name: "Void", chance: 1/750000000, multiplier: 1, color: "linear-gradient(90deg, #000000, #4b0082)" },
            { name: "nil", chance: 1/1000000000, multiplier: 1, color: "linear-gradient(90deg, #000000, #333333, #000000)" },
            { name: "Shiny", chance: 1/100, multiplier: 25, color: "#FFD700" },
            { name: "Gilded", chance: 1/125, multiplier: 125, color: "#FFA500" },
            { name: "Crystalized", chance: 1/500, multiplier: 250, color: "#e642f5" },
            { name: "Spectral", chance: 1/625, multiplier: 625, color: "#9400D3" },
            { name: "Inverse", chance: 1/1000, multiplier: 1000, color: "#8b49cc" },
            { name: "Extraordinary", chance: 1/1250, multiplier: 1250, color: "#FF1493" },
            { name: "Golden", chance: 1/1750, multiplier: 1750, color: "#eced9f" },
            { name: "Myriad", chance: 1/2500, multiplier: 2500, color: "#00FFFF" },
            { name: "Charred", chance: 1/4000, multiplier: 4000, color: "#FF4500" },
            { name: "Expert", chance: 1/7500, multiplier: 7500, color: "#00BFFF" },
            { name: "Wind", chance: 1/12500, multiplier: 12500, color: "#ADD8E6" }, 
            { name: "Mega", chance: 1/25000, multiplier: 25000, color: "#FF00FF" }, 
            { name: "Small", chance: 1/35000, multiplier: 35000, color: "#BEBEBE" }, 
            { name: "Monument", chance: 1/55555, multiplier: 55555, color: "#8B4513" }, 
            { name: "Endless", chance: 1/77777, multiplier: 77777, color: "#FFFFFF" },
            { name: "UNIVERSAL", chance: 1/100000, multiplier: 100000, color: "#D2691E" },
            { name: "Solar", chance: 1/250000, multiplier: 250000, color: "#FFA500" },
            { name: "Atomic", chance: 1/494500, multiplier: 494500, color: "#32CD32" },
            { name: "DARK", chance: 1/500000, multiplier: 500000, color: "#391a57" },
            { name: "Luminous", chance: 1/625000, multiplier: 625000, color: "#90ccdb" },
            { name: "Charged", chance: 1/750000, multiplier: 750000, color: "#90db90" },
            { name: "Ultimate", chance: 1/1e6, multiplier: 1e6, color: "#1e4259" },
            { name: "Ionized", chance: 1/2.5e6, multiplier: 2.5e6, color: "#c29bdb" },
            { name: "monochrome", chance: 1/1.6666e4, multiplier: 1.6666e4, color: "#5c5c5c" },
            { name: "GIANT", chance: 1/5e6, multiplier: 5e6, color: "#7dbd6a" },
            { name: "Hyper", chance: 1/1e7, multiplier: 1e7, color: "#261a57" },
            { name: "Reality", chance: 1/2.5e7, multiplier: 2.5e7, color: "#ffc4fc" },
            { name: "Exo", chance: 1/5e7, multiplier: 5e7, color: "#50877a" }, 
            { name: "Fortunium", chance: 1/77777777, multiplier: 77777777, color: "#5fb893" },
            { name: "ARCANE", chance: 1/1e8, multiplier: 1e8, color: "#ffffff" },
            { name: "Apex", chance: 1/2.5e8, multiplier: 2.5e8, color: "#66bab7" },
            { name: "Zenith", chance: 1/5e8, multiplier: 5e8, color: "#d7f5e8"},
            { name: "Void", chance: 1/750000000, multiplier: 750000000, color: "linear-gradient(90deg, #000000, #4b0082)" },
            { name: "nil", chance: 1/1000000000, multiplier: 1000000000, color: "linear-gradient(90deg, #000000, #333333, #000000)" },
            { name: "Negative", 
                chance: 1/5625, 
                multiplier: -1, 
                color: "#000000", 
                bypassCap: true,
                isNegative: true 
            },
            { 
                name: "Dull", 
                chance: 1/147382, 
                power: -1, 
                color: "#666666", 
                bypassCap: true,
                isDull: true
            }
        ];

        const RANK_TIERS = [
            { min: 0, max: 1.01, name: "TRASH"},
            { min: 1.01, max: 5, name: "Common" },
            { min: 5, max: 25, name: "Natural" },
            { min: 25, max: 50, name: "Uncommon" },
            { min: 50, max: 100, name: "Normal" },
            { min: 100, max: 100.1, name: "weird" },
            { min: 100.1, max: 500, name: "Divine" },
            { min: 500, max: 1000, name: "Grandiose" },
            { min: 1000, max: 2500, name: "Decent" },
            { min: 2500, max: 7500, name: "Unreal" },
            { min: 7500, max: 25000, name: "Cosmic" },
            { min: 25000, max: 100000, name: "Eternal" },
            { min: 100000, max: 500000, name: "Iridescent" },
            { min: 500000, max: 777777.77, name: "Exceptional" },
            { min: 777777.77, max: 788888.78, name: "Unordinary" },
            { min: 788888.78, max: 1e6, name: "Radioactive" },
            { min: 1e6, max: 5e6, name: "Heavenly" },
            { min: 5e6, max: 1e7, name: "Fantasy" },
            { min: 1e7, max: 5e7, name: "Unattainable" },
            { min: 5e7, max: 1e8, name: "Gigantic" },
            { min: 1e8, max: 2.5e8, name: "Epsilon" },
            { min: 2.5e8, max: 5e8, name: "Terafined" },
            { min: 5e8, max: 1e9, name: "Eclipse" },
            { min: 1e9, max: 5e9, name: "Infinitude" },
            { min: 5e9, max: 1e10, name: "Theoretical" },
            { min: 1e10, max: 1e11, name: "Unseeable" }, 
            { min: 1e11, max: 1e12, name: "Impassive" }, 
            { min: 1e12, max: 1e13, name: "Unrollable" },
            { min: 1e13, max: 1e14, name: "MACROSCOPIC" },
            { min: 1e14, max: 1e15, name: "Null" },
            { min: 1e15, max: 1e18, name: "Imaginary" },
            { min: 1e18, max: 1e21, name: "Impossible" },
            { min: 1e21, max: 1e24, name: "Astronomical" },
            { min: 1e24, max: 1e30, name: "Colossal" }, 
            { min: 1e30, max: 1.79e308, name: "Improbable" },
            { min: 1.79e308, max: Infinity, name: "Infinipossible" }
        ];

        // FIXED: Added Feimienation secret with serotonin animation
        const SECRET_RANKS_CHANCES = [
            { name: "BOOTLEG", chance: 1/200000000000, rarity: 200000000000, color: "#c0c0c0", animation: "bootleg" },
            { name: "BOOTLEG", chance: 1/200000000000, rarity: 200000000000, color: "#c0c0c0", animation: "bootleg" },
            { name: "nil_secret", chance: 1/17500, rarity: 17500 }, 
            { name: "Title Label Missing", chance: 1/4040.404, rarity: 4040.404 },
            { name: "?!? unknown ?!?", chance: 1/6666.666, rarity: 6666.666 },
            { name: "r", chance: 1/6942, rarity: 6942 },
            { name: "?!? bewilderment ?!?", chance: 1/450285, rarity: 450285 },
            { name: "Interminable", chance: 1/7777, rarity: 7777 },
            { name: "fish", chance: 1/7979, rarity: 7979 },
            { name: "cheese", chance: 1/9995, rarity: 9995 },
            { name: "üíØ", chance: 1/10000, rarity: 10000 },
            { name: "Minimal", chance: 1/15000, rarity: 15000 },
            { name: "c", chance: 1/33333, rarity: 33333 },
            { name: "Seize", chance: 1/97525, rarity: 97525 }, 
            { name: "Florescent", chance: 1/264839, rarity: 264839 },
            { name: "œÄ", chance: 1/314159, rarity: 314159 },
            { name: "breaktime", chance: 1/705372, rarity: 705372, timeBased: true },
            { name: "~Nonavacious~", chance: 1/575630, rarity: 575630 }, 
            { name: "Insanity", chance: 1/666666, rarity: 666666 }, 
            { name: "Grand", chance: 1/1e6, rarity: 1e6 },
            { name: "SUPERNOVA", chance: 1/7.271338e8, rarity: 7.271338e8 },
            { name: "pure", chance: 1/400000, rarity: 400000 },
            { name: "Omnipotence", chance: 1/1e18, rarity: 1e18 },
            { name: "7 GRAND DAD", chance: 1/777.777, rarity: 777.777, requiresGrand: true },
            { name: ":[{(absolute zero)}]:", chance: 1/1e6, rarity: 1e6 },
            { name: "alpha", chance: 1/123456, rarity: 123456 },
            { name: "beta", chance: 1/1234567, rarity: 1234567 },
            { name: "gamma", chance: 1/12345678, rarity: 12345678 },
            { name: "Defined", chance: 1/1.5e6, rarity: 1.5e6 },
            { name: "Finale.. wait, how'd this get here?", chance: 1/2.5e6, rarity: 2.5e6 },
            { name: "Pseudopseudohypoparathyroidism", chance: 1/5e6, rarity: 5e6 },
            { name: "secret^2", chance: 1/1e7, rarity: 1e7 },
            { name: "cheese: cheddar", chance: 1/1.5e7, rarity: 1.5e7 },
            { name: "QHAR ?!?", chance: 1/2.5e7, rarity: 2.5e7 },
            { name: "!! EUPHORIA !!", chance: 1/56789000, rarity: 56789000 },
            { name: "!!! S E R O T O N I N !!!", chance: 1/94.34e9, rarity: 94.34e9 },
            { name: "CORRUPTED", chance: 1/648236826.394, rarity: 648236826.394, eventOnly: "Hellish" },
            { name: "Chargoggagoggmanchauggauggagoggchaubunagungamaugg", chance: 1/77777777.77, rarity: 77777777.77 },
            { name: "‚õßSatanic‚õß", chance: 1/1e9, rarity: 1e9 },
            { name: "CATASTROPHIC", chance: 1/575765.565, rarity: 575765.5265, multiplier: 575765.565 },
            { name: "LEGACY In im table ?!?!?", chance: 1/11111111111111.111, rarity: 11111111111111.111, multiplier: 11111111111111.11 },
            { name: "Destroyed", chance: 0, rarity: Infinity, eventOnly: "Hidden", eventChance: 1/100000000 },
            { name: "cali^2", chance: 1/1e12, rarity: 1e12 },
            { name: "c : omega c", chance: 1/5.555e8, rarity: 5.555e8 },
            { name: "one", chance: 1/1.1111111e11, rarity: 1.1111111111e11 },
            { name: "NEXUS", chance: 1/1.0001e9, rarity: 1e9 },
            { name: "SUPREMITY", chance: 1/6.1862863e13, rarity: 6.1862863e13 },
            { name: "Mythical", chance: 1/750000, rarity: 750000 },
            { name: "Guardian", chance: 1/1234072637263827, rarity: 1234072637263827 },
            { name: "Obscure", chance: 1/6942069420, rarity: 6942069420 },
            { name: "Possible", chance: 1/28284.2712475, rarity: 28284.2712475 },
            { name: "chezburger", chance: 1/1.5e10, rarity: 1.5e10 },
            { name: "coal osal !!!", chance: 1/5551112, rarity: 5551112 },
            { name: "Obscam", chance: 1/888.8888888e6, rarity: 888.8888888e6 },
            { name: "probable", chance: 1/7.5e7, rarity: 7.5e7 },
            { name: "( N A M E L E S S )", chance: 1/9.99999999e9, rarity: 9.99999999e9 },
            { name: "Bootleg cali^2", chance: 1/1.01e6, rarity: 1e6 },
            { name: "!!! S E R O T O N I N !!!", chance: 1/94.34e9, rarity: 94.34e9 },
            { name: "Lol", chance: 0, rarity: 1e30, eventOnly: "ULTRA", eventChance: 1/1e6 },
            { name: "cali^0.5 (DEV EXCLUSIVE)", chance: 0, rarity: 69420, eventOnly: "Exclusivity", eventChance: 1/69420 },
            { name: "??? (DEV EXCLUSIVE)", chance: 0, rarity: 4.25e7, eventOnly: "Exclusivity", eventChance: 1/4.25e7 },
            { name: "Poly", chance: 1/175257625, rarity: 175257625 },
            { name: "Delusion", chance: 1/98900000, rarity: 98900000 },
            { name: "Maniac", chance: 1/7e7, rarity: 7e7 },
            { name: "Perlica", chance: 1/2e10, rarity: 2e10 },
            { name: "err.404notfound (DEV EXCLUSIVE)", chance: 0, rarity: 4.04e8, eventOnly: "Exclusivity", eventChance: 1/4.04e8 },
            { name: "WHAT THE FUCK", chance: 1/1e50, rarity: 1e50, multiplier: 1e50 },
            // NEW: Feimienation secret
            { name: "Feimienation", chance: 1/666999000100500125000250125950500690420000, rarity: 666999000100500125000250125950500690420000 }
        ];

        // Variant Secrets
        const VARIANT_SECRETS = [
            {
                name: "Sound",
                needsRank: "Uncommon",
                needsVariant: "Gilded",
                chance: 1/299,
                multipliesRNG: 855000,
                rarity: 299 * 125
            },
            { name: "ULTRATRASH", needsRank: "TRASH", needsVariant: "Ultimate", chance: 1/2, multipliesRNG: 1e9, rarity: 1e19 },
            { name: "F4LS3 R3A1I7Y", needsRank: "Eternal", needsVariant: "Atomic", chance: 1/50, multipliesRNG: 1e15, rarity: 1e15 },
            { name: "SUPERLARGE", needsRank: "Gigantic", needsVariant: "GIANT", chance: 1/100, mutlipliesRNG: 3.333e19, rarity: 3.333e19 }
        ];

        SECRET_RANKS_CHANCES.sort((a, b) => a.chance - b.chance); 

        const EUPHORIA_SYMBOLS = ['%', '@', '#', '^', '$', '*', '&', '>', '<', '?'];
        const SEROTONIN_SYMBOLS = ['?', '7', '@', 'SSER', '.', 'O!IN!', '?!?', 'S!O!?'];
        
        // FIXED: Perfect Base RNG Secrets - Now properly integrated
        const PERFECT_BASE_RNG_SECRETS = [];
        let rollIndex = 1;
        let acceptedRolls = new Set();
        let discoveredRanks = new Set();
        
        // NEW: Pending rolls system
        let pendingRolls = [];
        let maxPendingRolls = maxInventory * 3;
        
        // NEW: Secrets toggle
        let secretsEnabled = true;
        
        // NEW: Hardcore mode
        let hardcoreMode = false;
        let originalBulkRollLevel = 0;
        let originalLuck = 0;
        let originalVariantChance = 1;
        let originalSecretLuck = 1;
        
        // NEW: Scientific notation settings
        let sciNotationThreshold = DEFAULT_SCI_THRESHOLD;
        let sciNotationEnabled = true;
        
        // Auto-Accept Variables
        let autoAcceptThreshold = 0;
        let autoAcceptSecretThresholdValue = 0;
        let autoAcceptOnNewRank = false;
        let autoAcceptTrueRNGValue = 0;
        
        // Auto-Stop Variables
        let autoStopThreshold = 0;
        let autoStopSecretThresholdValue = 0;
        let autoStopOnNewRank = false;
        let autoStopTrueRNGValue = 0;
        
        let bulkRollLevel = 0;
        let bulkRollCost = 50000;
        let isCutscenePlaying = false; 
        
        // NEW: Cutscene state variable 
        let cutscenesEnabled = true; 
        
        // --- EVENT VARIABLES ---
        let currentEvent = null; 
        let eventEndTime = 0;    
        let eventInterval = null;
        let eventCheckChance = 1; 

        // --- SHAPES VARIABLES ---
        let geometrix = 0;
        let shapesUnlocked = false;
        let shapeLuckLevel = 0;
        let shapeLuckCost = 5;
        let luckMultiLevel = 0;
        let luckMultiCost = 100;
        let bulkShapeLevel = 0;
        let bulkShapeCost = 50;
        let shapeInterval = null;
        let activeShapes = [];

        // --- CLICKER VARIABLES ---
        let clickerUnlocked = false;
        let fortunium = 0;
        let fortuniumLuck = 0;
        
        let gmxMultiLevel = 0;
        let gmxMultiCost = 75;
        
        let fortuniumLuckLevel = 0;
        let fortuniumLuckCost = 125;
        
        let clickerLuckLevel = 0;
        let clickerLuckCost = 1000;

        // --- EUPHORIA EFFECT ---
        let activeEuphoriaIntervals = {};
        let activeSerotoninIntervals = {};

        // --- Bewilderment animation intervals ---
        let activeBewildermentIntervals = {};

        // --- Animation preservation tracking ---
        let activeAnimationElements = new Set();
        
        // --- BOOSTER SYSTEM ---
        let boosters = [];
        let activeBooster = null;
        let shopBoosters = [];
        let shopAutoRefreshInterval = null;

        // --- NEW: Variant Secrets ---
        let discoveredVariantSecrets = new Set();

        // --- OPTIMIZATION: CALCULATED STATS ---
        let currentLuck = 0;
        let secretLuckMultiplier = 1;
        let variantChanceMultiplier = 1;

        // --- CALCULATED STATS ---
        let luckMultiValue = 1;
        let shapeLuckBonus = 0;
        let currentShapeCooldown = SHAPE_SPAWN_INTERVAL_MS;

        // NEW: Destroy System Variables
        let destroyCount = 0;
        let destroyCost = DESTROY_BASE_COST;
        let currentDimension = 1;
        let dimensions = []; // Array to store each dimension's state
        let destroyLuckMultiplier = 1;
        let destroyCurrencyMultiplier = 1;

        // --- UTILITY FUNCTIONS ---
        function formatInteger(num) {
            return num.toLocaleString('en-US');
        }

        function formatNumber(num) {
            if (calisrng2.ruin) return "Lol";
            
            if (num < 0) {
                return "-" + formatNumber(Math.abs(num));
            }
            
            if (sciNotationEnabled && Math.abs(num) >= sciNotationThreshold) {
                return num.toExponential(2);
            }
            
            return num.toLocaleString('en-US', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            });
        }
        
        function formatGeometrix(num) {
            if (calisrng2.ruin) return "Lol";
            
            if (sciNotationEnabled && Math.abs(num) >= sciNotationThreshold) {
                return num.toExponential(2);
            }
            return num.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        
        function formatCooldown(ms) {
            if (calisrng2.ruin) return "Lol";
            return (ms / 1000).toFixed(4);
        }

        function escapeHTML(str) {
            if (!str) return '';
            return str.replace(/'/g, "\\'");
        }

        // --- MODIFIED INVENTORY SORT FUNCTION ---
        function sortInventory(type) {
            if (type === 'baseRNGAsc') {
                inventory.sort((a, b) => calculateBaseRNGValue(a) - calculateBaseRNGValue(b));
            } else if (type === 'baseRNGDesc') {
                inventory.sort((a, b) => calculateBaseRNGValue(b) - calculateBaseRNGValue(a));
            }
            updateInventoryDisplay();
            preserveAnimations();
            addToTerminal(`Inventory sorted by ${type === 'baseRNGDesc' ? 'base RNG (descending)' : 'base RNG (ascending)'}.`, true);
            saveGame();
        }
        
        function calculateBaseRNGValue(item) {
            // Start with base value
            let value = item.baseValue || item.value;
            
            // Apply variant multipliers
            if (item.variants && item.variants.length > 0) {
                item.variants.forEach(variant => {
                    const variantData = VARIANTS.find(v => v.name === variant.name);
                    if (variantData && variantData.multiplier) {
                        if (variantData.isNegative) {
                            value *= -1;
                        } else if (variantData.isDull) {
                            if (value !== 0) {
                                value = Math.pow(value, -1);
                            }
                        } else {
                            value *= variantData.multiplier;
                        }
                    }
                });
            }
            
            return value;
        }

        // --- MODIFIED DESTROY SYSTEM FUNCTIONS ---
        function updateDimensionSelector() {
            const dimensionSelect = document.getElementById('dimensionSelect');
            if (!dimensionSelect) return;
            
            // Clear current options
            dimensionSelect.innerHTML = '';
            
            // Add Dimension 1
            const option1 = document.createElement('option');
            option1.value = '1';
            option1.textContent = 'Dimension 1';
            dimensionSelect.appendChild(option1);
            
            // Add other dimensions from dimensions array
            dimensions.forEach(dim => {
                if (dim.dimensionNumber > 1) {
                    const option = document.createElement('option');
                    option.value = dim.dimensionNumber.toString();
                    option.textContent = `Dimension ${dim.dimensionNumber}`;
                    dimensionSelect.appendChild(option);
                }
            });
            
            // Add current dimension if not in list
            if (currentDimension > 1 && !dimensions.some(d => d.dimensionNumber === currentDimension)) {
                const option = document.createElement('option');
                option.value = currentDimension.toString();
                option.textContent = `Dimension ${currentDimension} (Current)`;
                dimensionSelect.appendChild(option);
            }
            
            // Set current selection
            dimensionSelect.value = currentDimension.toString();
        }
        
        function switchToSelectedDimension() {
            const dimensionSelect = document.getElementById('dimensionSelect');
            const selectedDimension = parseInt(dimensionSelect.value);
            
            if (selectedDimension === currentDimension) {
                addToTerminal(`Already in Dimension ${currentDimension}!`, true);
                return;
            }
            
            if (selectedDimension < currentDimension) {
                // Switching to lower dimension
                if (confirm(`Switch to Dimension ${selectedDimension}?\n\nYou'll lose current progress in Dimension ${currentDimension} unless you save it first with another Destroy.`)) {
                    loadDimension(selectedDimension);
                }
            } else {
                // Switching to higher dimension
                addToTerminal(`Cannot switch to Dimension ${selectedDimension} - must destroy to reach higher dimensions!`, true);
            }
        }
        
        // Update the updateDimensionList function
        function updateDimensionList() {
            const dimensionList = document.getElementById('dimensionList');
            if (!dimensionList) return;
            
            let html = '';
            
            // Always show Dimension 1
            html += `<div class="dimension-item ${currentDimension === 1 ? 'current' : ''}">Dimension 1: 1.00x Luck, 1.00x Currency</div>`;
            
            // Show saved dimensions
            dimensions.forEach(dim => {
                if (dim.dimensionNumber > 1) {
                    const luckMulti = 1 + ((dim.dimensionNumber - 1) * DESTROY_LUCK_MULTI_PER_DESTROY);
                    const currencyMulti = 1 + ((dim.dimensionNumber - 1) * DESTROY_CURRENCY_MULTI_PER_DESTROY);
                    html += `<div class="dimension-item ${currentDimension === dim.dimensionNumber ? 'current' : ''}">
                        Dimension ${dim.dimensionNumber}: ${luckMulti.toFixed(2)}x Luck, ${currencyMulti.toFixed(2)}x Currency
                    </div>`;
                }
            });
            
            // Show current dimension if not saved yet
            if (currentDimension > 1 && !dimensions.some(d => d.dimensionNumber === currentDimension)) {
                const luckMulti = 1 + ((currentDimension - 1) * DESTROY_LUCK_MULTI_PER_DESTROY);
                const currencyMulti = 1 + ((currentDimension - 1) * DESTROY_CURRENCY_MULTI_PER_DESTROY);
                html += `<div class="dimension-item current">
                    Dimension ${currentDimension}: ${luckMulti.toFixed(2)}x Luck, ${currencyMulti.toFixed(2)}x Currency (Current)
                </div>`;
            }
            
            dimensionList.innerHTML = html;
            
            // Update current dimension stats display
            const currentDimensionStats = document.getElementById('currentDimensionStats');
            if (currentDimensionStats) {
                const luckMulti = 1 + ((currentDimension - 1) * DESTROY_LUCK_MULTI_PER_DESTROY);
                const currencyMulti = 1 + ((currentDimension - 1) * DESTROY_CURRENCY_MULTI_PER_DESTROY);
                currentDimensionStats.textContent = `Dimension ${currentDimension}: ${luckMulti.toFixed(2)}x Luck, ${currencyMulti.toFixed(2)}x Currency`;
            }
            
            // Update dimension selector
            updateDimensionSelector();
        }

        // --- FIXED SHOP FUNCTIONS ---
        
        function generateShapeHTML(shape, color, luck, variant) {
            const size = 60;
            const centerLuck = luck.toFixed(2);
            
            const hexToRgb = (hex) => {
                const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? {
                    r: parseInt(result[1], 16),
                    g: parseInt(result[2], 16),
                    b: parseInt(result[3], 16)
                } : { r: 255, g: 255, b: 255 };
            };
            
            const darkenColor = (hex, amount = 0.4) => {
                const rgb = hexToRgb(hex);
                const r = Math.max(0, Math.floor(rgb.r * (1 - amount)));
                const g = Math.max(0, Math.floor(rgb.g * (1 - amount)));
                const b = Math.max(0, Math.floor(rgb.b * (1 - amount)));
                return `rgb(${r},${g},${b})`;
            };
            
            const darkColor = darkenColor(color);
            const gradientId = `grad-${Math.random().toString(36).substr(2, 9)}`;
            
            let svg = '';
            if (shape === 'circle') {
                svg = `<svg width="${size}" height="${size}" viewBox="0 0 60 60">
                    <defs>
                        <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:${color};stop-opacity:1" />
                            <stop offset="100%" style="stop-color:${darkColor};stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <circle cx="30" cy="30" r="25" fill="url(#${gradientId})" stroke="#FFD700" stroke-width="2"/>
                    <text x="30" y="35" text-anchor="middle" fill="white" stroke="black" stroke-width="0.5" font-size="14" font-weight="bold">${centerLuck}</text>
                </svg>`;
            } else if (shape === 'triangle') {
                svg = `<svg width="${size}" height="${size}" viewBox="0 0 60 60">
                    <defs>
                        <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:${color};stop-opacity:1" />
                            <stop offset="100%" style="stop-color:${darkColor};stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <polygon points="30,10 50,45 10,45" fill="url(#${gradientId})" stroke="#FFD700" stroke-width="2"/>
                    <text x="30" y="37" text-anchor="middle" fill="white" stroke="black" stroke-width="0.5" font-size="14" font-weight="bold">${centerLuck}</text>
                </svg>`;
            } else if (shape === 'square') {
                svg = `<svg width="${size}" height="${size}" viewBox="0 0 60 60">
                    <defs>
                        <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:${color};stop-opacity:1" />
                            <stop offset="100%" style="stop-color:${darkColor};stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <rect x="12" y="12" width="36" height="36" fill="url(#${gradientId})" stroke="#FFD700" stroke-width="2"/>
                    <text x="30" y="35" text-anchor="middle" fill="white" stroke="black" stroke-width="0.5" font-size="14" font-weight="bold">${centerLuck}</text>
                </svg>`;
            } else if (shape === 'pentagon') {
                svg = `<svg width="${size}" height="${size}" viewBox="0 0 60 60">
                    <defs>
                        <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:${color};stop-opacity:1" />
                            <stop offset="100%" style="stop-color:${darkColor};stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <polygon points="30,8 52,22 43,44 17,44 8,22" fill="url(#${gradientId})" stroke="#FFD700" stroke-width="2"/>
                    <text x="30" y="35" text-anchor="middle" fill="white" stroke="black" stroke-width="0.5" font-size="14" font-weight="bold">${centerLuck}</text>
                </svg>`;
            } else if (shape === 'hexagon') {
                svg = `<svg width="${size}" height="${size}" viewBox="0 0 60 60">
                    <defs>
                        <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:${color};stop-opacity:1" />
                            <stop offset="100%" style="stop-color:${darkColor};stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <polygon points="30,8 52,18 52,40 30,50 8,40 8,18" fill="url(#${gradientId})" stroke="#FFD700" stroke-width="2"/>
                    <text x="30" y="35" text-anchor="middle" fill="white" stroke="black" stroke-width="0.5" font-size="14" font-weight="bold">${centerLuck}</text>
                </svg>`;
            } else if (shape === 'heptagon') {
                svg = `<svg width="${size}" height="${size}" viewBox="0 0 60 60">
                    <defs>
                        <linearGradient id="${gradientId}" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:${color};stop-opacity:1" />
                            <stop offset="100%" style="stop-color:${darkColor};stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <polygon points="30,6 50,14 55,34 43,50 17,50 5,34 10,14" fill="url(#${gradientId})" stroke="#FFD700" stroke-width="2"/>
                    <text x="30" y="35" text-anchor="middle" fill="white" stroke="black" stroke-width="0.5" font-size="14" font-weight="bold">${centerLuck}</text>
                </svg>`;
            }
            
            return svg + (variant ? `<div style="font-size: ${variant.name === 'GIANT' ? '55px' : variant.name === 'mega' ? '27.5px' : variant.name === 'small' ? '8.25px' : '11px'}; color: ${variant.color || '#FFD700'}; margin-top: 3px; font-weight: bold;">${variant.name}</div>` : '');
        }
        
        // --- NEW DEBUG FUNCTIONS ---
        
        function nukeShopData() {
            if (!confirm("This will reset ALL shop data, including owned boosters and shop inventory. Continue?")) return;
            
            boosters = [];
            activeBooster = null;
            shopBoosters = [];
            
            shopLastRefresh = 0;
            
            if (shopAutoRefreshInterval) {
                clearInterval(shopAutoRefreshInterval);
                shopAutoRefreshInterval = null;
            }
            
            shopBoosters = [];
            
            addToTerminal("üí£ Shop data COMPLETELY nuked! All boosters, shop inventory, and shop state reset.", true, 'rank-1000000-100000000');
            updateBoosterDisplay();
            
            const shopPanel = document.getElementById('shop-panel');
            if (shopPanel) {
                shopPanel.style.display = 'none';
            }
            
            saveGame();
        }
        
        function fixSaveFile() {
            if (!confirm("This will attempt to fix common save file issues. Continue?")) return;
            
            try {
                const saved = localStorage.getItem('calisRNGGame');
                if (!saved) {
                    addToTerminal("No save file found to fix.", true);
                    return;
                }
                
                let gameState;
                try {
                    gameState = JSON.parse(saved);
                } catch (e) {
                    addToTerminal("Save file is corrupt. Creating new one...", true, 'rank-1000000-100000000');
                    localStorage.removeItem('calisRNGGame');
                    location.reload();
                    return;
                }
                
                const fixes = [];
                
                if (!Array.isArray(gameState.inventory)) {
                    gameState.inventory = [];
                    fixes.push("Fixed: inventory was not an array");
                }
                
                if (!Array.isArray(gameState.pendingRolls)) {
                    gameState.pendingRolls = [];
                    fixes.push("Fixed: pendingRolls was not an array");
                }
                
                if (!Array.isArray(gameState.boosters)) {
                    gameState.boosters = [];
                    fixes.push("Fixed: boosters was not an array");
                }
                
                if (!Array.isArray(gameState.shopBoosters)) {
                    gameState.shopBoosters = [];
                    fixes.push("Fixed: shopBoosters was not an array");
                }
                
                if (!Array.isArray(gameState.discoveredVariantSecrets)) {
                    gameState.discoveredVariantSecrets = [];
                    fixes.push("Fixed: discoveredVariantSecrets was not an array");
                }
                
                if (typeof gameState.currency !== 'number' || isNaN(gameState.currency)) {
                    gameState.currency = 0;
                    fixes.push("Fixed: currency was invalid");
                }
                
                if (typeof gameState.geometrix !== 'number' || isNaN(gameState.geometrix)) {
                    gameState.geometrix = 0;
                    fixes.push("Fixed: geometrix was invalid");
                }
                
                if (!Array.isArray(gameState.discoveredRanks)) {
                    gameState.discoveredRanks = [];
                    fixes.push("Fixed: discoveredRanks was not an array");
                }
                
                if (!gameState.highestFinalRoll || typeof gameState.highestFinalRoll !== 'object') {
                    gameState.highestFinalRoll = { 
                        value: 0, 
                        baseValue: 0, 
                        rank: 'None yet', 
                        variants: [], 
                        isSecret: false 
                    };
                    fixes.push("Fixed: highestFinalRoll was missing");
                }
                
                // NEW: Fix destroy system data
                if (typeof gameState.destroyCount !== 'number') {
                    gameState.destroyCount = 0;
                    fixes.push("Fixed: destroyCount was invalid");
                }
                
                if (typeof gameState.destroyCost !== 'number') {
                    gameState.destroyCost = DESTROY_BASE_COST;
                    fixes.push("Fixed: destroyCost was invalid");
                }
                
                if (typeof gameState.currentDimension !== 'number') {
                    gameState.currentDimension = 1;
                    fixes.push("Fixed: currentDimension was invalid");
                }
                
                if (!Array.isArray(gameState.dimensions)) {
                    gameState.dimensions = [];
                    fixes.push("Fixed: dimensions array was missing");
                }
                
                if (typeof gameState.destroyLuckMultiplier !== 'number') {
                    gameState.destroyLuckMultiplier = 1;
                    fixes.push("Fixed: destroyLuckMultiplier was invalid");
                }
                
                if (typeof gameState.destroyCurrencyMultiplier !== 'number') {
                    gameState.destroyCurrencyMultiplier = 1;
                    fixes.push("Fixed: destroyCurrencyMultiplier was invalid");
                }
                
                // Check all arrays for invalid items
                if (Array.isArray(gameState.inventory)) {
                    const validInventory = [];
                    for (let i = 0; i < gameState.inventory.length; i++) {
                        const item = gameState.inventory[i];
                        if (item && typeof item === 'object' && item.value !== undefined && item.rank) {
                            if (typeof item.value !== 'number' || isNaN(item.value)) {
                                fixes.push(`Fixed: inventory item ${i} had invalid value`);
                                item.value = 0;
                            }
                            if (!Array.isArray(item.variants)) {
                                item.variants = [];
                            }
                            validInventory.push(item);
                        } else {
                            fixes.push(`Removed invalid inventory item ${i}`);
                        }
                    }
                    gameState.inventory = validInventory;
                }
                
                // Check pending rolls
                if (Array.isArray(gameState.pendingRolls)) {
                    const validPending = [];
                    for (let i = 0; i < gameState.pendingRolls.length; i++) {
                        const item = gameState.pendingRolls[i];
                        if (item && typeof item === 'object' && item.value !== undefined && item.rank) {
                            if (typeof item.value !== 'number' || isNaN(item.value)) {
                                fixes.push(`Fixed: pending roll ${i} had invalid value`);
                                item.value = 0;
                            }
                            if (!Array.isArray(item.variants)) {
                                item.variants = [];
                            }
                            validPending.push(item);
                        } else {
                            fixes.push(`Removed invalid pending roll ${i}`);
                        }
                    }
                    gameState.pendingRolls = validPending;
                }
                
                // Check boosters
                if (Array.isArray(gameState.boosters)) {
                    const validBoosters = [];
                    for (let i = 0; i < gameState.boosters.length; i++) {
                        const booster = gameState.boosters[i];
                        if (booster && typeof booster === 'object' && booster.luck !== undefined) {
                            if (typeof booster.luck !== 'number' || isNaN(booster.luck)) {
                                fixes.push(`Fixed: booster ${i} had invalid luck`);
                                booster.luck = BOOSTER_BASE_LUCK;
                            }
                            validBoosters.push(booster);
                        } else {
                            fixes.push(`Removed invalid booster ${i}`);
                        }
                    }
                    gameState.boosters = validBoosters;
                }
                
                // Check shop boosters
                if (Array.isArray(gameState.shopBoosters)) {
                    const validShopBoosters = [];
                    for (let i = 0; i < gameState.shopBoosters.length; i++) {
                        const booster = gameState.shopBoosters[i];
                        if (booster && typeof booster === 'object' && booster.luck !== undefined) {
                            if (typeof booster.luck !== 'number' || isNaN(booster.luck)) {
                                fixes.push(`Fixed: shop booster ${i} had invalid luck`);
                                booster.luck = BOOSTER_BASE_LUCK;
                            }
                            validShopBoosters.push(booster);
                        } else {
                            fixes.push(`Removed invalid shop booster ${i}`);
                        }
                    }
                    gameState.shopBoosters = validShopBoosters;
                }
                
                // Check active shapes
                if (Array.isArray(gameState.activeShapes)) {
                    const validShapes = [];
                    for (let i = 0; i < gameState.activeShapes.length; i++) {
                        const shape = gameState.activeShapes[i];
                        if (shape && typeof shape === 'object' && shape.name) {
                            validShapes.push(shape);
                        } else {
                            fixes.push(`Removed invalid shape ${i}`);
                        }
                    }
                    gameState.activeShapes = validShapes;
                }
                
                // Ensure maxPendingRolls is calculated correctly
                if (!gameState.maxPendingRolls || typeof gameState.maxPendingRolls !== 'number') {
                    gameState.maxPendingRolls = (gameState.maxInventory || 10) * 3;
                    fixes.push("Fixed: maxPendingRolls was invalid");
                }
                
                localStorage.setItem('calisRNGGame', JSON.stringify(gameState));
                
                if (fixes.length > 0) {
                    addToTerminal(`‚úÖ Save file fixed! Applied ${fixes.length} fix(es):`, true, 'rank-1000000-100000000');
                    fixes.forEach(fix => {
                        addToTerminal(`  ‚Ä¢ ${fix}`, true);
                    });
                    addToTerminal("Reloading game...", true);
                    setTimeout(() => location.reload(), 1000);
                } else {
                    addToTerminal("‚úÖ Save file is already healthy. No fixes needed.", true);
                }
                
            } catch (e) {
                console.error('Error fixing save:', e);
                addToTerminal("‚ùå Failed to fix save file. Error: " + e.message, true, 'rank-1000000-100000000');
            }
        }
        
        function inspectSaveFile() {
            const saved = localStorage.getItem('calisRNGGame');
            
            if (!saved) {
                addToTerminal("No save file found!", true);
                return;
            }
            
            addToTerminal("üîç INSPECTING SAVE FILE...", true, 'rank-1000-10000');
            
            try {
                const gameState = JSON.parse(saved);
                const issues = [];
                const warnings = [];
                const info = [];
                
                const criticalProps = ['currency', 'totalUpgrades', 'inventory', 'discoveredRanks'];
                criticalProps.forEach(prop => {
                    if (!(prop in gameState)) {
                        issues.push(`Missing critical property: ${prop}`);
                    }
                });
                
                // NEW: Check destroy system props
                const destroyProps = ['destroyCount', 'destroyCost', 'currentDimension', 'dimensions'];
                destroyProps.forEach(prop => {
                    if (!(prop in gameState)) {
                        issues.push(`Missing destroy property: ${prop}`);
                    }
                });
                
                if (!Array.isArray(gameState.inventory)) {
                    issues.push("Inventory is not an array");
                }
                
                if (!Array.isArray(gameState.discoveredRanks)) {
                    issues.push("discoveredRanks is not an array");
                }
                
                if (typeof gameState.currency !== 'number') {
                    issues.push("Currency is not a number");
                }
                
                if (typeof gameState.geometrix !== 'number') {
                    issues.push("Geometrix is not a number");
                }
                
                if (isNaN(gameState.currency)) {
                    issues.push("Currency is NaN");
                }
                
                if (isNaN(gameState.geometrix)) {
                    issues.push("Geometrix is NaN");
                }
                
                if (gameState.currency < 0) {
                    warnings.push("Currency is negative");
                }
                
                if (gameState.geometrix < 0) {
                    warnings.push("Geometrix is negative");
                }
                
                // Check inventory items
                if (Array.isArray(gameState.inventory)) {
                    gameState.inventory.forEach((item, idx) => {
                        if (!item || typeof item !== 'object') {
                            issues.push(`Inventory item ${idx} is corrupted`);
                        } else {
                            if (typeof item.value !== 'number' || isNaN(item.value)) {
                                issues.push(`Inventory item ${idx} has invalid value`);
                            }
                            if (!item.rank || typeof item.rank !== 'string') {
                                issues.push(`Inventory item ${idx} has invalid rank`);
                            }
                            if (!Array.isArray(item.variants)) {
                                issues.push(`Inventory item ${idx} has invalid variants array`);
                            }
                        }
                    });
                }
                
                // Check pending rolls
                if (Array.isArray(gameState.pendingRolls)) {
                    gameState.pendingRolls.forEach((item, idx) => {
                        if (!item || typeof item !== 'object') {
                            issues.push(`Pending roll ${idx} is corrupted`);
                        } else {
                            if (typeof item.value !== 'number' || isNaN(item.value)) {
                                issues.push(`Pending roll ${idx} has invalid value`);
                            }
                            if (!item.rank || typeof item.rank !== 'string') {
                                issues.push(`Pending roll ${idx} has invalid rank`);
                            }
                        }
                    });
                }
                
                // Check boosters
                if (Array.isArray(gameState.boosters)) {
                    gameState.boosters.forEach((booster, idx) => {
                        if (!booster || typeof booster !== 'object') {
                            issues.push(`Booster ${idx} is corrupted`);
                        } else {
                            if (typeof booster.luck !== 'number' || isNaN(booster.luck)) {
                                issues.push(`Booster ${idx} has invalid luck`);
                            }
                        }
                    });
                }
                
                // Check shop boosters
                if (Array.isArray(gameState.shopBoosters)) {
                    gameState.shopBoosters.forEach((booster, idx) => {
                        if (!booster || typeof booster !== 'object') {
                            issues.push(`Shop booster ${idx} is corrupted`);
                        } else {
                            if (typeof booster.luck !== 'number' || isNaN(booster.luck)) {
                                issues.push(`Shop booster ${idx} has invalid luck`);
                            }
                        }
                    });
                }
                
                // Check active shapes
                if (Array.isArray(gameState.activeShapes)) {
                    gameState.activeShapes.forEach((shape, idx) => {
                        if (!shape || typeof shape !== 'object') {
                            issues.push(`Active shape ${idx} is corrupted`);
                        }
                    });
                }
                
                // Check discovered variant secrets
                if (!Array.isArray(gameState.discoveredVariantSecrets)) {
                    issues.push("discoveredVariantSecrets is not an array");
                }
                
                // NEW: Check destroy system
                if (!Array.isArray(gameState.dimensions)) {
                    issues.push("dimensions is not an array");
                }
                
                if (typeof gameState.destroyCount !== 'number' || gameState.destroyCount < 0) {
                    issues.push("destroyCount is invalid");
                }
                
                if (typeof gameState.currentDimension !== 'number' || gameState.currentDimension < 1) {
                    issues.push("currentDimension is invalid");
                }
                
                info.push(`Currency: ${gameState.currency || 0}`);
                info.push(`Geometrix: ${gameState.geometrix || 0}`);
                info.push(`Upgrades: ${gameState.totalUpgrades || 0}`);
                info.push(`Inventory size: ${gameState.inventory ? gameState.inventory.length : 0}`);
                info.push(`Discovered ranks: ${gameState.discoveredRanks ? gameState.discoveredRanks.length : 0}`);
                info.push(`Discovered variant secrets: ${gameState.discoveredVariantSecrets ? gameState.discoveredVariantSecrets.length : 0}`);
                info.push(`Boosters owned: ${gameState.boosters ? gameState.boosters.length : 0}`);
                info.push(`Shop inventory: ${gameState.shopBoosters ? gameState.shopBoosters.length : 0}`);
                info.push(`Active shapes: ${gameState.activeShapes ? gameState.activeShapes.length : 0}`);
                info.push(`Pending rolls: ${gameState.pendingRolls ? gameState.pendingRolls.length : 0}`);
                info.push(`Hardcore mode: ${gameState.hardcoreMode ? 'ON' : 'OFF'}`);
                info.push(`Secrets enabled: ${gameState.secretsEnabled !== false ? 'Yes' : 'No'}`);
                info.push(`Cutscenes enabled: ${gameState.cutscenesEnabled !== false ? 'Yes' : 'No'}`);
                // NEW: Destroy system info
                info.push(`Destroy count: ${gameState.destroyCount || 0}`);
                info.push(`Current dimension: ${gameState.currentDimension || 1}`);
                info.push(`Destroy cost: ${gameState.destroyCost || DESTROY_BASE_COST}`);
                info.push(`Dimensions stored: ${gameState.dimensions ? gameState.dimensions.length : 0}`);
                
                if (issues.length > 0) {
                    addToTerminal("‚ùå ISSUES FOUND:", true, 'rank-1000000-100000000');
                    issues.forEach(issue => {
                        addToTerminal(`  ‚Ä¢ ${issue}`, true);
                    });
                } else {
                    addToTerminal("‚úÖ No critical issues found", true, 'rank-1000-10000');
                }
                
                if (warnings.length > 0) {
                    addToTerminal("‚ö†Ô∏è WARNINGS:", true, 'rank-1000-10000');
                    warnings.forEach(warning => {
                        addToTerminal(`  ‚Ä¢ ${warning}`, true);
                    });
                }
                
                addToTerminal("üìä SAVE FILE INFO:", true, 'rank-1000-10000');
                info.forEach(line => {
                    addToTerminal(`  ${line}`, true);
                });
                
                if (issues.length > 0) {
                    addToTerminal("üí° Run 'Fix Save File' to attempt to repair these issues.", true);
                }
                
            } catch (e) {
                addToTerminal(`‚ùå ERROR PARSING SAVE FILE: ${e.message}`, true, 'rank-1000000-100000000');
                addToTerminal("The save file appears to be corrupt.", true);
            }
        }

        // --- EXISTING DEBUG FUNCTIONS ---
        
        function toggleForceRollUI() {
            const ui = document.getElementById('force-roll-ui');
            if (ui) {
                ui.style.display = ui.style.display === 'none' ? 'block' : 'none';
            }
        }

        function executeCustomForceRoll() {
            const luck = parseFloat(document.getElementById('forceRollLuck').value) || 0;
            const variantLuck = parseFloat(document.getElementById('forceRollVariantLuck').value) || 0;
            const secretLuck = parseFloat(document.getElementById('forceRollSecretLuck').value) || 0;
            
            const customLuck = currentLuck + luck + variantLuck;
            const baseRoll = Math.pow(Math.random(), 3 / POWER_EXPONENT) * (1 + customLuck);
            
            const variantResult = getVariants(baseRoll);
            let displayValue = variantResult ? variantResult.modifiedValue : baseRoll;
            const variants = variantResult ? variantResult.variants : [];
            
            let secretResult = null;
            if (secretsEnabled) {
                const originalSecretMultiplier = secretLuckMultiplier;
                secretLuckMultiplier = Math.max(1, secretLuckMultiplier + secretLuck);
                secretResult = getSecretRank();
                secretLuckMultiplier = originalSecretMultiplier;
            }
            let rankInfo = getRankInfo(baseRoll);
            let displayName = secretResult ? secretResult.name : rankInfo.name;
            
            if (rankInfo.isUnobtainable) {
                displayName = hardcoreMode ? "Unobtainable [HC]" : "Unobtainable";
                displayValue = rankInfo.value;
            }
            
            if (secretResult && secretResult.rarity) {
                displayValue *= secretResult.rarity;
            }
            
            if (displayName === "CORRUPTED") {
                displayValue *= -1;
            }
            if (displayName === "Destroyed") {
                displayValue = 0;
            }
            
            const { className: rankClass, color: rollColor } = getRankClassAndColor(displayValue, variants, displayName);
            
            let variantText = '';
            if (variants.length > 0) {
                variantText = variants.map(v => {
                    let variantClass = '';
                    if (v.name === "GIANT") variantClass = 'variant-GIANT';
                    else if (v.name === "Mega") variantClass = 'variant-Mega';
                    else if (v.name === "Small") variantClass = 'variant-Small';
                    
                    return `<span class="${variantClass}" style="color: ${v.color}; font-weight: bold;">[${v.name}]</span>`;
                }).join('') + ' ';
            }
            
            const debugTag = '<span style="color: #ffaa00; font-weight: bold;">[CUSTOM]</span>';
            
            const content = `<span class="${rankClass} illegitimate-roll" style="color: ${rollColor};">${formatNumber(displayValue)} [${displayName}] ${debugTag}</span>`;
            
            addToTerminal(
                `#${formatInteger(rollIndex++)} (CUSTOM): L${luck} VL${variantLuck} SL${secretLuck} | ${variantText}${content} (No currency, no discovery)`
            );
            
            toggleForceRollUI();
        }

        // --- VARIANT SECRETS FUNCTIONS ---
        
        function getVariantSecret(rankName, variants) {
            if (variants.length === 0) return null;
            
            for (const secret of VARIANT_SECRETS) {
                if (rankName === secret.needsRank || 
                    (hardcoreMode && rankName === `${secret.needsRank} [HC]`)) {
                    
                    const hasRequiredVariant = variants.some(v => v.name === secret.needsVariant);
                    
                    if (hasRequiredVariant) {
                        if (Math.random() < secret.chance) {
                            return secret;
                        }
                    }
                }
            }
            
            return null;
        }

        // --- MODIFIED ROLL FUNCTION WITH ALL FIXES ---
        
